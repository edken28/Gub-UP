<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB2OEoFPk-eNzqSwK-JFXBrmssU01NeVkE",
    authDomain: "gub-up.firebaseapp.com",
    projectId: "gub-up",
    storageBucket: "gub-up.firebasestorage.app",
    messagingSenderId: "75119179497",
    appId: "1:75119179497:web:2e0195a3dfd4fb03e5a278",
    measurementId: "G-9MGFP3RC88"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const welcomeBanner = document.querySelector('h2.text-3xl.font-bold') || document.querySelector('.bg-brand-blue h2');
      if (welcomeBanner) {
        welcomeBanner.innerText = `Welcome back, ${user.email}!`;
      }

      try {
        const userDoc = await getDoc(doc(db, "users", user.uid));
        if (userDoc.exists()) {
          const userData = userDoc.data();
          
          const nameDisplay = document.querySelector('button.flex.items-center.gap-2.bg-blue-50 span');
          if (nameDisplay) {
            nameDisplay.innerText = userData.name;
          }
        }
      } catch (error) {
        console.error("Error loading user details:", error);
      }
    } else {
      window.location.href = "login.html";
    }
  });

  window.handleLogout = () => {
    signOut(auth).then(() => {
      window.location.href = "login.html";
    });
  };
</script>
