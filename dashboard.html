<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyB2OEoFPk-eNzqSwK-JFXBrmssU01NeVkE",
    authDomain: "gub-up.firebaseapp.com",
    projectId: "gub-up",
    storageBucket: "gub-up.firebasestorage.app",
    messagingSenderId: "75119179497",
    appId: "1:75119179497:web:2e0195a3dfd4fb03e5a278",
    measurementId: "G-9MGFP3RC88"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // 1. SECURITY CHECK: Is the user logged in?
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      // User is logged in, let's get their data
      const userDoc = await getDoc(doc(db, "users", user.uid));
      
      if (userDoc.exists()) {
        const userData = userDoc.data();
        
        // Update the "Citizen" button text to show their real name
        const userButton = document.querySelector('.bg-blue-50.text-brand-blue'); 
        if(userButton) userButton.innerHTML = `<i data-lucide="user" class="w-4 h-4"></i> ${userData.name}`;
        
        console.log("Welcome,", userData.name, "from", userData.barangay);
      }
    } else {
      // No user is logged in, send them to login page
      window.location.href = "login.html";
    }
  });

  // 2. LOGOUT LOGIC
  const logoutBtn = document.querySelector('button:contains("Logout")') || document.querySelector('a[href*="logout"]');
  // If you have a logout button, link it here:
  document.querySelectorAll('button').forEach(btn => {
    if(btn.innerText.includes('Logout')) {
      btn.addEventListener('click', () => {
        signOut(auth).then(() => {
          window.location.href = "login.html";
        });
      });
    }
  });
</script>
